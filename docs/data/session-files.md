# Session Files

Each session is a set of files generated by the collector application and stored in a single folder.

## File naming

- `metadata__{session_key}.yaml`: session metadata file
- `accel_{session_key}.csv`: data collected from accelerometer sensor
- `gyro_{session_key}.csv`: data collected from gyroscope sensor
- `labels_{session_key}.csv`: labels data from user input

Example from `data/Data_20251226`:

```text
data/
  Data_20251226/
    metadata__20251226_114336.yaml
    accel_20251226_114336.csv
    gyro_20251226_114336.csv
    labels_20251226_114336.csv
```

## Metadata file (`metadata__*.yaml`)

Field details:

| Field | Required | Description |
| --- | --- | --- |
| `session_start_time` | yes | Session start datetime. Used to build the session key. |
| `sensor_name` | yes | Human-readable sensor/device name. |
| `*` | no | Any additional fields are preserved in session metadata. |

Example:
```yaml
sensor_name: STBPRO3 @71E957
session_start_time: 2025-12-26 11:43:36
```

## Sensor files (`accel_*.csv` and `gyro_*.csv`)

Both sensor files share the same schema. The loader uses `sensor_type` to
distinguish accelerometer from gyroscope rows.

Field details:

| Field | Required | Description                                                   |
| --- | --- |---------------------------------------------------------------|
| `timestamp` | yes | Unix milliseconds. Converted to datetime during load.         |
| `lat` | yes | Latitude in decimal degrees. Can be empty for some rows.      |
| `lon` | yes | Longitude in decimal degrees. Can be empty for some rows.     |
| `sensor_timestamp` | yes | Device monotonic index (integer). Used to align accel/gyro.   |
| `sensor_type` | yes | Sensor name string (for logging).                             |
| `x` | yes | X axis value. Acceleration for accel, rotation rate for gyro. |
| `y` | yes | Y axis value. Acceleration for accel, rotation rate for gyro. |
| `z` | yes | Z axis value. Acceleration for accel, rotation rate for gyro. |
| `elapsed` | no | Nanoseconds since start. If missing it is derived.            |
| `raw_data` | no | Extra payload kept in output but not used by the loader.      |

Notes:
- `lat`/`lon` can be empty for some rows; rows without GPS are dropped after the
  accelerometer/gyroscope merge.

Accelerometer example:
```csv
timestamp,lat,lon,sensor_timestamp,sensor_type,x,y,z,raw_data
1766749421286,40.4076043,-3.6258028,30694,Accelerometer,36.0,-53.0,994.0,E6772400CBFFE2030500FEFF0000
1766749421291,40.4076043,-3.6258028,30696,Accelerometer,39.0,-59.0,1006.0,E8772700C5FFEE03030000000000
```

Gyroscope example:
```csv
timestamp,lat,lon,sensor_timestamp,sensor_type,x,y,z,raw_data
1766749421290,40.4076043,-3.6258028,30694,Gyroscope,0.5,-0.2,0.0,E6772400CBFFE2030500FEFF0000
1766749421294,40.4076043,-3.6258028,30696,Gyroscope,0.3,0.0,0.0,E8772700C5FFEE03030000000000
```

## Labels file (`labels_*.csv`)

Field details:

| Field | Required | Description |
| --- | --- | --- |
| `timestamp` | yes | Unix milliseconds for the label event. |
| `lat` | yes | Latitude in decimal degrees. |
| `lon` | yes | Longitude in decimal degrees. |
| `label` | yes | Label name (for example: `pothole`, `speed_bump`, `manhole`, `other`). |

Example records:
```csv
timestamp,lat,lon,label
1766749473266,40.407912,-3.6259785,speed_bump
1766749479880,40.407912,-3.6259785,speed_bump
1766749721385,40.4160833,-3.62707,other
```

## How labels are merged

Labels are matched to the closest sensor row by timestamp, with a tolerance of
1 second. Unmatched labels remain in the labels table but are not merged into
the session signal data.
